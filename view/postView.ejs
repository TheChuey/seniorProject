<link rel="stylesheet" href="/css/heading.css">
<section id="2">
  <div class="card save">
    <h1> Title: </h1>
    <div id="grabTitle"><%- title %> </div>
    <div id="message">
      <p>Message: <%- content %></p>
      <button id="save" onclick="save()" style="background:green">
        Save
      </button>
    </div>
  </div>

</section>

<section id="3">
  <% results.forEach(function(titleAndContent) { %>
  <div class="card del">
    <h1><%- titleAndContent.title %></h1>
    <div id="message">
      <%- titleAndContent.content %>
      <button id="delete" onclick="del(`<%- titleAndContent.title %>`)" style="background:red">
        Delete
      </button>

      <button id="edit" onclick="editFunction()" style="background:blue">
        edit
      </button>
    </div>
    <div id="1"></div>
  </div>

  <% }); %>
</section>

</div>
<script>
  document.getElementById("save").addEventListener("click", save);

  function save() {
    let postElement = document.querySelector(".save");
    let grabTitle = document.getElementById("grabTitle");

    const savedContent = grabTitle.textContent
    const saveData = {
      content: savedContent
    };
    console.log("class element ", postElement, grabTitle.textContent, saveData);
    fetch('/save', {
        method: 'POST', // or 'PUT'
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(saveData),
      })
      .then(saveData => {
        console.log('save return -->', saveData);
        if (saveData.status === 200) {
          console.log("sucess");
          if (confirm("Post saved! Press Ok to Post or Repost") == true) {
            // postElement.remove();
            document.getElementById("2").innerHTML = "You pressed OK!";
          } else {
            document.getElementById("2").innerHTML = "You canceled!";
          }
        } else if (saveData.status === 404) {
          alert("not saved");
        }
      })
      .catch((error) => {
        console.error('Error:', error);
      }); // end of del function
  }



  function del(postTitle) {
    console.log("class element ", postTitle);
    let postElement = document.querySelector(".del");

    const data = {
      content: postTitle
    };
    console.log("data object sent via POST ", data);
    fetch('/delete', {
        method: 'POST', // or 'PUT'
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
      })
      .then(data => {
        console.log('Success:', data);
        if (data.status === 200) {
          console.log("sucess");

          if (confirm("Post Deleted") && true) {
            postElement.remove();
          }

        };
      })
      .catch((error) => {
        console.error('Error:', error);
      }); // end of del function


  }
</script>